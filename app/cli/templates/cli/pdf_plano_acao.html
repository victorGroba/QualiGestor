<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Plano de Ação - {{ aplicacao.id }}</title>
  <style>
    @page {
      size: A4;
      margin: 3cm 1cm 2cm 1cm;
      @bottom-center { content: "Página " counter(page); }
    }
    body { font-family: Helvetica, Arial, sans-serif; font-size: 10pt; color: #333; }
    
    /* Cabeçalho */
    .header { width: 100%; border-bottom: 2px solid #e67e22; padding-bottom: 10px; margin-bottom: 20px; }
    .header table { width: 100%; }
    .header h1 { margin: 0; color: #e67e22; text-transform: uppercase; font-size: 16pt; text-align: right; }
    .header p { margin: 0; color: #777; font-size: 9pt; text-align: right; }

    /* Info Box */
    .info-box { background: #f8f9fa; padding: 15px; border: 1px solid #ddd; margin-bottom: 20px; border-radius: 4px; }
    .info-table { width: 100%; }
    .info-label { font-size: 8pt; color: #7f8c8d; text-transform: uppercase; font-weight: bold; }
    .info-value { font-size: 11pt; font-weight: bold; color: #2c3e50; }

    /* Tabela Principal */
    .main-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .main-table th { background: #eee; text-align: left; padding: 8px; border-bottom: 2px solid #ccc; font-size: 9pt; }
    .main-table td { padding: 10px 8px; border-bottom: 1px solid #eee; vertical-align: top; }
    
    .status-nc { color: #c0392b; font-weight: bold; white-space: nowrap; }
    .plano-text { background: #fffcf5; border-left: 3px solid #f1c40f; padding: 5px 10px; font-style: italic; }

    /* Assinaturas */
    .signatures { margin-top: 50px; width: 100%; page-break-inside: avoid; }
    .sig-col { width: 45%; text-align: center; vertical-align: bottom; }
    .sig-img { max-height: 80px; max-width: 200px; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; }
    .sig-line { border-top: 1px solid #333; margin: 5px 20px 0 20px; }
    .sig-name { font-weight: bold; font-size: 10pt; margin-top: 5px; }
    .sig-role { font-size: 8pt; color: #777; }
  </style>
</head>
<body>

  <div class="header">
    <table>
      <tr>
        <td style="text-align: left;">
            <h2 style="margin:0; color:#333;">QualiGestor</h2>
        </td>
        <td>
            <h1>Plano de Ação</h1>
            <p>Relatório de Correções #{{ aplicacao.id }}</p>
        </td>
      </tr>
    </table>
  </div>

  <div class="info-box">
    <table class="info-table">
        <tr>
            <td width="50%">
                <div class="info-label">Unidade Avaliada</div>
                <div class="info-value">{{ aplicacao.avaliado.nome }}</div>
            </td>
            <td width="25%">
                <div class="info-label">Data</div>
                <div class="info-value">{{ aplicacao.data_inicio.strftime('%d/%m/%Y') }}</div>
            </td>
            <td width="25%">
                <div class="info-label">Itens NC</div>
                <div class="info-value" style="color: #c0392b">{{ respostas|length }}</div>
            </td>
        </tr>
    </table>
  </div>

  <h3 style="border-bottom: 1px solid #eee; padding-bottom: 5px; color: #555;">Detalhamento das Ações</h3>
  
  <table class="main-table">
    <thead>
        <tr>
            <th width="40%">Item Auditado</th>
            <th width="15%">Status</th>
            <th width="45%">Plano de Ação Definido</th>
        </tr>
    </thead>
    <tbody>
        {% for item in respostas %}
        <tr>
            <td>
                <strong>{{ item.pergunta.texto }}</strong>
                {% if item.observacao %}
                    <br><small style="color:#666;">Obs: {{ item.observacao }}</small>
                {% endif %}
            </td>
            <td class="status-nc">{{ item.resposta }}</td>
            <td>
                <div class="plano-text">
                    {{ item.plano_acao or 'Não definido' }}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
  </table>

  <table class="signatures">
      <tr>
          <td class="sig-col">
              {% if assinatura_uri %}
                  <img src="{{ assinatura_uri }}" class="sig-img">
                  <div class="sig-line"></div>
                  <div class="sig-name">{{ assinatura_responsavel or 'Responsável' }}</div>
                  <div class="sig-role">{{ cargo_responsavel or 'Gestor da Unidade' }}</div>
              {% else %}
                  <div style="height: 80px;"></div>
                  <div class="sig-line"></div>
                  <div class="sig-name">Responsável pela Unidade</div>
                  <div class="sig-role">(Assinatura Pendente)</div>
              {% endif %}
          </td>
          
          <td width="10%"></td>

          <td class="sig-col">
              <div style="height: 85px;"></div>
              <div class="sig-line"></div>
              <div class="sig-name">
                  {{ aplicacao.aplicador.nome if aplicacao.aplicador else 'Consultor QualiGestor' }}
              </div>
              <div class="sig-role">Auditor Técnico</div>
          </td>
      </tr>
  </table>

</body>
</html>