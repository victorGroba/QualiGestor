{% extends "base_cliq.html" %}

{% block title %}Gestão de Planos de Ação{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-dark border-start border-5 border-warning ps-3 mb-0">
                <i class="fas fa-tasks me-2 text-warning"></i>Gestão de Planos de Ação
            </h2>
            <p class="text-muted ms-3 mb-0">Auditorias com não conformidades pendentes de tratativa.</p>
        </div>
    </div>

    <div class="row">
        {% for app in aplicacoes %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow-sm h-100 border-0 hover-effect">
                
                <div class="card-header bg-white border-bottom-0 pt-3 pb-0">
                    <div class="d-flex justify-content-between align-items-start">
                        <span class="badge bg-primary fs-6">{{ app.avaliado.nome }}</span>
                        <div class="text-end">
                            <span class="d-block fw-bold text-dark">{{ app.data_inicio.strftime('%d/%m/%Y') }}</span>
                            <small class="text-muted">{{ app.data_inicio.strftime('%H:%M') }}</small>
                        </div>
                    </div>
                </div>

                <div class="card-body pt-2">
                    <h5 class="card-title text-dark mb-1">Auditoria #{{ app.id }}</h5>
                    <p class="text-muted small mb-3 text-truncate" title="{{ app.questionario.nome }}">
                        <i class="fas fa-clipboard-list me-1"></i> {{ app.questionario.nome }}
                    </p>

                    <div class="bg-light rounded p-2 mb-3 small">
                        <div class="row g-1">
                            <div class="col-12 mb-1">
                                <i class="fas fa-user-tie me-1 text-secondary"></i> 
                                <strong>Aplicador:</strong> {{ app.aplicador.nome if app.aplicador else 'Sistema' }}
                            </div>
                            
                            <div class="col-6">
                                <i class="fas fa-clock me-1 text-secondary"></i> 
                                <strong>Duração:</strong> 
                                {% if app.data_fim %}
                                    {{ ((app.data_fim - app.data_inicio).total_seconds() / 60) | round | int }} min
                                {% else %}
                                    -
                                {% endif %}
                            </div>
                            
                            <div class="col-6">
                                <i class="fas fa-star me-1 text-secondary"></i> 
                                <strong>Nota:</strong> 
                                <span class="{{ 'text-success' if app.nota_final >= 70 else 'text-danger' }} fw-bold">
                                    {{ app.nota_final | round(1) }}%
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <a href="{{ url_for('cli.detalhe_plano_acao', aplicacao_id=app.id) }}" class="btn btn-outline-warning text-dark fw-bold">
                            <i class="fas fa-folder-open me-2"></i> Abrir Pendências
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <div class="text-muted opacity-50 mb-3">
                <i class="fas fa-clipboard-check fa-4x"></i>
            </div>
            <h4>Nenhum plano de ação pendente!</h4>
            <p class="text-muted">Todas as auditorias estão conformes ou foram tratadas.</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
.hover-effect { transition: transform 0.2s, box-shadow 0.2s; }
.hover-effect:hover { transform: translateY(-3px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; }
</style>
{% endblock %}